


### **实时渲染管线四大阶段​**​

#### ​**​1. 应用阶段（Application Stage）​**​

- ​**​执行位置​**​：CPU（通用处理器）
- ​**​核心功能​**​：
    - 驱动应用程序逻辑（碰撞检测、动画、物理模拟等）
    - 实现全局加速算法（如场景剔除）
    - 处理外部输入（键盘、鼠标、VR设备等）
- ​**​特点​**​：
    - ​**​软件实现​**​，开发者拥有完全控制权
    - 利用CPU多核并行处理多线程任务
    - 输出渲染图元（点、线、三角形）至几何阶段
#### ​**​2. 几何处理阶段（Geometry Processing）​**​

- ​**​执行位置​**​：GPU（图形处理器）
- ​**​核心功能​**​：
    - 几何变换（坐标转换、投影）
    - 确定物体绘制方式与位置（顶点着色、光照计算）
    - 裁剪与视口变换
- ​**​特点​**​：
    - 包含可编程单元（如顶点着色器）和固定硬件单元
    - 输出三角形顶点数据至光栅化阶段
#### ​**​3. 光栅化阶段（Rasterization）​**​

- ​**​执行位置​**​：GPU
- ​**​核心功能​**​：
    - 将三角形分解为像素（片元）
    - 确定哪些像素位于三角形内部
    
- ​**​特点​**​：
    - 硬件高度优化，并行处理三角形填充
    - 输出像素位置信息至像素处理阶段
#### ​**​4. 像素处理阶段（Pixel Processing）​**​

- ​**​执行位置​**​：GPU
- ​**​核心功能​**​：
    - 逐像素着色（执行片元着色器）
    - 深度测试（判断像素可见性）
    - 颜色混合（如透明度处理）
- ​**​特点​**​：
    - 决定最终屏幕像素颜色
    - 支持复杂效果（纹理采样、光照模型计算）


---

## 应用阶段

1. ​**​执行平台与可控性​**​：
    - 主要运行在 ​**​CPU​**​ 上。
    - 开发者对此阶段拥有​**​完全控制权​**​，可以自由实现和优化应用程序逻辑。
    - 对此阶段的修改能​**​影响后续渲染阶段的性能​**​（例如，减少需渲染的三角形数量）。
    
2. ​**​GPU 参与的可能性​**​：
    - 部分任务可通过 ​**​计算着色器 (Compute Shader)​**​ 在 GPU 上执行。
    - 此时 GPU 被视为​**​高度并行的通用处理器​**​，而非专用的图形处理器。
    
3. ​**​核心任务与输出​**​：
    - ​**​最重要的任务​**​：准备并输出需要渲染的几何物体（​**​渲染图元​**​）。
    - ​**​渲染图元类型​**​：点 (Point)、线 (Line)、三角形 (Triangle)。
    - ​**​输出目标​**​：这些图元最终将显示在屏幕或其他显示设备上。
    
4. ​**​阶段特性​**​：
    - ​**​基于软件实现 (Software-based)​**​：这是渲染管线中唯一一个主要基于软件（CPU）的阶段。
    - ​**​无标准子阶段划分​**​：不像后续的几何处理、光栅化等阶段有明确的子阶段划分（尽管 CPU 内部流水线可视为子阶段）。
    - ​**​并行化​**​：为提升效率，通常会利用 CPU 的​**​多核 (Multi-core)​**​ 架构进行并行处理（多进程/多线程）。
    
5. ​**​承担的其他关键功能​**​：
    - ​**​碰撞检测 (Collision Detection)​**​：检测物体间的碰撞，并生成响应（反馈给物体或力反馈设备）。
    - ​**​输入处理​**​：处理来自键盘、鼠标、头戴式显示器等设备的输入，并据此执行相应操作。
    - ​**​加速算法实现​**​：执行特定的​**​剔除算法 (Culling)​**​（详见第19章）等优化技术。
    - ​**​“兜底”处理​**​：处理渲染管线其他阶段​**​无法处理的一切问题​**​。

---




### **光栅化阶段​**​

#### ​**​1. 阶段定位​**​

- ​**​承上启下​**​：接收几何处理阶段输出的​**​顶点数据​**​（含变换后的位置、深度值、着色信息等），输出待处理的​**​像素片段​**​（fragments）至像素处理阶段。
- ​**​同步点作用​**​：作为几何处理与像素处理阶段的​**​桥梁​**​，确保图元数据向像素数据的转换。

#### ​**​2. 核心目标​**​

- ​**​像素定位​**​：找出所有位于待渲染图元（点、线、三角形）内部的​**​像素​**​（picture element）。
- ​**​数据传递​**​：为每个像素关联顶点数据（如深度值z、颜色、纹理坐标等）。

#### ​**​3. 子阶段划分​**​

1. ​**​三角形设置（图元装配）​**​
    - 将几何阶段输出的​**​顶点​**​组装成完整图元（如三角形）。
    - 预计算图元属性（如边方程、插值参数），为遍历阶段优化计算。

2. ​**​三角形遍历（扫描变换）​**​
    - ​**​核心操作​**​：逐像素检测是否位于图元内部（如通过重心坐标测试）。
    - ​**​输出​**​：生成​**​像素片段​**​（fragment），包含：
        - 屏幕位置（x, y）
        - 深度值（z）
        - 插值后的着色数据（颜色、法线、UV坐标等）

#### ​**​4. 关键特性​**​
- ​**​术语别名​**​：光栅化 = ​**​扫描变换​**​（Scan Conversion），本质是​**​2D顶点→屏幕像素​**​的映射过程。
- ​**​通用性​**​：虽以“三角形”命名子阶段，但同样适用于​**​点、线​**​等其他图元。
- ​**​深度值保留​**​：传递顶点z值至像素片段，供后续​**​深度测试​**​使用。
- ​**​数据插值​**​：在遍历阶段对顶点属性（如颜色）进行​**​线性插值​**​，生成平滑的像素级数据。

---

## **像素覆盖判定方法​**​

光栅化的核心任务之一是判断屏幕像素是否与待渲染图元（如三角形）重叠，主要依赖以下技术实现：

#### ​**​1. 点采样（Point Sampling）​**​

- ​**​基本原理​**​：以​**​像素中心点​**​作为采样位置。
- ​**​判定规则​**​：
    - 若像素中心位于三角形内部 → 判定该像素属于三角形覆盖区域。
    - 若中心在外部 → 判定为未覆盖。
- ​**​特点​**​：
    - ​**​计算简单​**​，硬件实现成本低。
    - 易导致​**​锯齿（Aliasing）​**​ 问题（三角形边缘呈阶梯状）。

#### ​**​2. 多重采样抗锯齿（Multisampling Antialiasing, MSAA）​**​

- ​**​原理​**​：
    - 对每个像素进行​**​多次子采样​**​（如4x、8x），采样点分布在像素不同位置（非仅中心）。
    - 根据子采样点被三角形覆盖的比例，​**​混合计算​**​最终像素颜色。
- ​**​目标​**​：
    - ​**​缓解边缘锯齿​**​，提升视觉平滑度（详见章节5.4.2）。
- ​**​性能代价​**​：
    - 增加显存占用和计算量（子采样数越高，效果越好，开销越大）。

#### ​**​3. 保守光栅化（Conservative Rasterization）​**
​
- ​**​判定规则​**​：
    - 只要像素​**​有任何部分​**​与三角形重叠 → 即判定为覆盖。
- ​**​应用场景​**​：
    - 需要​**​绝对覆盖保证​**​的场合（如物理碰撞检测、体素化、精确遮挡查询）。
- ​**​特点​**​：
    - 避免因采样点遗漏导致的“漏判”（详见章节23.1.2）。
    - 可能略微​**​扩大渲染范围​**​（比实际三角形稍大）。

### **技术对比​**​

| ​**​方法​**​      | ​**​判定依据​**​ | ​**​优势​**​   | ​**​劣势​**​  | ​**​典型用途​**​ |
| --------------- | ------------ | ------------ | ----------- | ------------ |
| ​**​点采样​**​     | 仅像素中心位置      | 计算高效，硬件支持成熟  | 边缘锯齿明显      | 基础实时渲染       |
| ​**​多重采样抗锯齿​**​ | 多个子采样点覆盖率    | 显著改善视觉平滑度    | 性能开销大       | 高质量图形（游戏/影视） |
| ​**​保守光栅化​**​   | 像素与三角形任意重叠区域 | 确保无遗漏覆盖，结果精确 | 渲染范围可能略大于实际 | 物理引擎、GPU计算任务 |

---

